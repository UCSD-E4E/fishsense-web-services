static_file_server:
  image: nginx:1.29.1-alpine
  depends_on:
    - fishsense-api
  labels:
    - "traefik.enable=true"
    - "traefik.http.routers.fishsense_static_file_server.rule=Host(`orchestrator.fishsense.e4e.ucsd.edu`) && PathPrefix(`/api/v1/data`)"
    - "traefik.http.routers.fishsense_static_file_server.entrypoints=websecure"
    - "traefik.http.routers.fishsense_static_file_server.tls.certresolver=letsencrypt"
  volumes:
    - ./static_file_server/nginx.conf:/etc/nginx/conf.d/default.conf
    - ./static_file_server_volumes/data:/data
  networks:
    - traefik_proxy
    - orchestrator
  restart: on-failure:15

fishsense-api:
  container_name: fishsense-api
  image: ghcr.io/ucsd-e4e/fishsense-api:v1.0.2
  volumes:
    - ./fishsense_api_volumes/config:/e4efs/config:ro
  networks:
    - orchestrator
  restart: on-failure:15